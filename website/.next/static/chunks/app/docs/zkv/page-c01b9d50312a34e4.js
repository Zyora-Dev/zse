(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9399],{5120:function(e,s,t){Promise.resolve().then(t.bind(t,356))},356:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return l}});var n=t(3827),i=t(9676),a=t(5558),r=t(4657),o=t(4987);let c=[{id:"overview",title:"Overview",level:2},{id:"how-it-works",title:"How It Works",level:2},{id:"configuration",title:"Configuration",level:2},{id:"persistent-cache",title:"Persistent Cache",level:2},{id:"memory-optimization",title:"Memory Optimization",level:2}];function l(){return(0,n.jsxs)("div",{className:"flex",children:[(0,n.jsxs)("article",{className:"flex-1 min-w-0 py-8 px-6 lg:px-10",children:[(0,n.jsx)(i.lv,{title:"zKV",description:"Intelligent KV cache management for optimal memory usage and prompt caching.",badge:"Feature"}),(0,n.jsxs)(i.Je,{id:"overview",title:"Overview",children:[(0,n.jsxs)("p",{className:"mb-4",children:[(0,n.jsx)(a.Z,{children:"zKV"})," manages the key-value cache used during inference, enabling prompt caching, memory optimization, and long-context conversations."]}),(0,n.jsxs)(o.gy,{columns:3,children:[(0,n.jsx)(o.Zb,{title:"Prompt Caching",description:"Reuse computations for repeated prompts"}),(0,n.jsx)(o.Zb,{title:"4-bit KV",description:"Compressed cache for long contexts"}),(0,n.jsx)(o.Zb,{title:"Persistence",description:"Save/load KV state to disk"})]}),(0,n.jsx)(o.VS,{features:["Automatic prompt prefix caching","4-bit KV cache compression","Paged attention for dynamic memory","Disk-backed KV for very long contexts","Multi-user cache isolation"]})]}),(0,n.jsxs)(i.Je,{id:"how-it-works",title:"How It Works",children:[(0,n.jsx)("p",{className:"mb-4",children:"The KV (key-value) cache stores intermediate computations from the attention mechanism. Without caching, these must be recomputed for every token generated."}),(0,n.jsx)(a.d,{language:"text",code:'Without KV Cache:\n┌──────────────────────────────────────────────────────┐\n│ Prompt: "The quick brown fox"                        │\n│ → Compute attention for all tokens (4 forward passes)│\n│ → Generate "jumps" (recompute all + new token)       │\n│ → Generate "over"  (recompute all + new tokens)      │\n│ → Total: O(n\xb2) computations                          │\n└──────────────────────────────────────────────────────┘\n\nWith KV Cache:\n┌──────────────────────────────────────────────────────┐\n│ Prompt: "The quick brown fox"                        │\n│ → Compute attention, STORE in KV cache               │\n│ → Generate "jumps" (reuse cache + 1 new computation) │\n│ → Generate "over"  (reuse cache + 1 new computation) │\n│ → Total: O(n) computations                           │\n└──────────────────────────────────────────────────────┘'}),(0,n.jsx)(r.U,{type:"info",children:"KV caching typically provides 10-100x speedup for generation after the initial prompt processing."})]}),(0,n.jsxs)(i.Je,{id:"configuration",title:"Configuration",children:[(0,n.jsxs)(i.KU,{id:"cache-size",title:"Cache Size",children:[(0,n.jsx)(a.d,{language:"bash",code:"# Set maximum context length (determines cache size)\nzse serve model.zse --max-context 8192\n\n# Set maximum cache memory\nzse serve model.zse --kv-cache-memory 4GB\n\n# Dynamic cache sizing\nzse serve model.zse --kv-cache dynamic"}),(0,n.jsx)("p",{className:"mt-4 mb-2",children:"Memory requirements per context length (7B model):"}),(0,n.jsx)("div",{className:"overflow-x-auto my-4",children:(0,n.jsxs)("table",{className:"w-full text-sm",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{className:"border-b border-white/10",children:[(0,n.jsx)("th",{className:"text-left py-2 pr-4 text-white/50 font-medium",children:"Context"}),(0,n.jsx)("th",{className:"text-right py-2 px-4 text-white/50 font-medium",children:"FP16 KV"}),(0,n.jsx)("th",{className:"text-right py-2 pl-4 text-white/50 font-medium",children:"4-bit KV"})]})}),(0,n.jsxs)("tbody",{className:"text-white/70",children:[(0,n.jsxs)("tr",{className:"border-b border-white/[0.05]",children:[(0,n.jsx)("td",{className:"py-2 pr-4",children:"4,096"}),(0,n.jsx)("td",{className:"text-right py-2 px-4",children:"1.0 GB"}),(0,n.jsx)("td",{className:"text-right py-2 pl-4 text-lime",children:"0.3 GB"})]}),(0,n.jsxs)("tr",{className:"border-b border-white/[0.05]",children:[(0,n.jsx)("td",{className:"py-2 pr-4",children:"8,192"}),(0,n.jsx)("td",{className:"text-right py-2 px-4",children:"2.0 GB"}),(0,n.jsx)("td",{className:"text-right py-2 pl-4 text-lime",children:"0.5 GB"})]}),(0,n.jsxs)("tr",{className:"border-b border-white/[0.05]",children:[(0,n.jsx)("td",{className:"py-2 pr-4",children:"32,768"}),(0,n.jsx)("td",{className:"text-right py-2 px-4",children:"8.0 GB"}),(0,n.jsx)("td",{className:"text-right py-2 pl-4 text-lime",children:"2.0 GB"})]}),(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{className:"py-2 pr-4",children:"131,072"}),(0,n.jsx)("td",{className:"text-right py-2 px-4",children:"32 GB"}),(0,n.jsx)("td",{className:"text-right py-2 pl-4 text-lime",children:"8.0 GB"})]})]})]})})]}),(0,n.jsxs)(i.KU,{id:"prompt-caching",title:"Prompt Caching",children:[(0,n.jsx)("p",{className:"mb-2",children:"ZSE automatically caches common prompt prefixes:"}),(0,n.jsx)(a.d,{language:"python",code:'from zllm_zse import ZSE\n\nmodel = ZSE("qwen-7b.zse")\n\n# First request - full computation\nresponse1 = model.chat([\n    {"role": "system", "content": "You are a helpful assistant..."},  # Cached\n    {"role": "user", "content": "Hello!"}\n])  # ~500ms\n\n# Second request - reuses system prompt cache\nresponse2 = model.chat([\n    {"role": "system", "content": "You are a helpful assistant..."},  # From cache!\n    {"role": "user", "content": "How are you?"}\n])  # ~50ms (10x faster)'}),(0,n.jsx)("p",{className:"mt-4 mb-2",children:"Configure prompt caching:"}),(0,n.jsx)(a.d,{language:"yaml",filename:"zse.yaml",code:'kv_cache:\n  prompt_cache: true\n  prompt_cache_size: 1GB\n  prompt_cache_ttl: 3600  # seconds\n  \n  # Cache specific prefixes\n  prefixes:\n    - name: "default_system"\n      content: "You are a helpful assistant..."\n      preload: true'})]}),(0,n.jsxs)(i.KU,{id:"compression",title:"KV Cache Compression",children:[(0,n.jsx)("p",{className:"mb-2",children:"Enable 4-bit KV cache for longer contexts:"}),(0,n.jsx)(a.d,{language:"bash",code:"# Enable 4-bit KV cache\nzse serve model.zse --kv-quant int4\n\n# 8-bit KV cache (better quality)\nzse serve model.zse --kv-quant int8"}),(0,n.jsx)(a.d,{language:"python",code:'from zllm_zse import ZSE\n\n# Enable quantized KV cache\nmodel = ZSE("qwen-7b.zse", kv_quant="int4")\n\n# Now supports 4x longer contexts!\nresponse = model.chat(\n    messages=[...],\n    max_context=131072  # 128K context\n)'})]})]}),(0,n.jsxs)(i.Je,{id:"persistent-cache",title:"Persistent Cache",children:[(0,n.jsx)("p",{className:"mb-4",children:"Save and restore KV cache for long-running conversations:"}),(0,n.jsx)(a.d,{language:"python",code:'from zllm_zse import ZSE\n\nmodel = ZSE("qwen-7b.zse")\n\n# Start conversation\nsession = model.create_session()\nsession.chat([{"role": "user", "content": "My name is Alice"}])\nsession.chat([{"role": "user", "content": "I live in New York"}])\n\n# Save session state (includes KV cache)\nsession.save("alice_session.zse")\n\n# Later: restore session\nsession = model.load_session("alice_session.zse")\nresponse = session.chat([{"role": "user", "content": "What\'s my name?"}])\n# → "Your name is Alice"'}),(0,n.jsx)(i.KU,{id:"session-api",title:"Session Management API",children:(0,n.jsx)(a.d,{language:"python",code:"from zllm_zse import ZSE, Session\n\nmodel = ZSE(\"qwen-7b.zse\")\n\n# Create named session\nsession = model.create_session(name=\"user_123\")\n\n# List sessions\nsessions = model.list_sessions()\nprint(sessions)  # ['user_123', 'user_456', ...]\n\n# Get session info\ninfo = session.info()\nprint(info)\n# {\n#   'name': 'user_123',\n#   'context_length': 1024,\n#   'cache_size_bytes': 52428800,\n#   'created_at': '2024-01-15T10:30:00Z'\n# }\n\n# Clear session\nsession.clear()\n\n# Delete session\nmodel.delete_session(\"user_123\")"})})]}),(0,n.jsxs)(i.Je,{id:"memory-optimization",title:"Memory Optimization",children:[(0,n.jsxs)(i.KU,{id:"paged-attention",title:"Paged Attention",children:[(0,n.jsx)("p",{className:"mb-2",children:"Paged attention allocates KV cache in fixed-size blocks, reducing memory fragmentation:"}),(0,n.jsx)(a.d,{language:"bash",code:"# Enable paged attention\nzse serve model.zse --paged-attention\n\n# Configure block size\nzse serve model.zse --paged-attention --block-size 16"}),(0,n.jsx)(o.VS,{features:["Reduces memory fragmentation","Enables dynamic batch sizes","More concurrent requests with same memory"]})]}),(0,n.jsxs)(i.KU,{id:"memory-tiers",title:"Memory Tiers",children:[(0,n.jsx)("p",{className:"mb-2",children:"ZSE can use CPU memory and disk as overflow for KV cache:"}),(0,n.jsx)(a.d,{language:"yaml",filename:"zse.yaml",code:"kv_cache:\n  tiers:\n    - type: gpu\n      size: 8GB\n      priority: 1\n      \n    - type: cpu\n      size: 32GB\n      priority: 2\n      \n    - type: disk\n      path: /tmp/zse_kv_cache\n      size: 100GB\n      priority: 3\n      \n  eviction: lru  # Evict least-recently-used"}),(0,n.jsx)(r.U,{type:"warning",children:"CPU and disk tiers add latency. Use GPU memory for latency-sensitive workloads."})]}),(0,n.jsx)(i.KU,{id:"cache-stats",title:"Cache Statistics",children:(0,n.jsx)(a.d,{language:"python",code:"from zllm_zse import ZSE\n\nmodel = ZSE(\"qwen-7b.zse\")\n\n# Get cache statistics\nstats = model.kv_cache_stats()\nprint(stats)\n# {\n#   'total_size': 8589934592,      # 8 GB\n#   'used_size': 2147483648,       # 2 GB\n#   'prompt_cache_hits': 1542,\n#   'prompt_cache_misses': 89,\n#   'hit_rate': 0.945,\n#   'evictions': 23\n# }\n\n# Clear cache\nmodel.clear_kv_cache()\n\n# Clear specific session\nmodel.clear_kv_cache(session=\"user_123\")"})})]}),(0,n.jsx)(i.KO,{prev:{title:"zStream",href:"/docs/zstream"},next:{title:"CLI Reference",href:"/docs/api/cli"}})]}),(0,n.jsx)(i.o5,{items:c})]})}},4987:function(e,s,t){"use strict";t.d(s,{Rg:function(){return o},VS:function(){return c},Zb:function(){return l},gy:function(){return m}});var n=t(3827),i=t(5293),a=t(9259),r=t(2169);function o(e){let{steps:s}=e;return(0,n.jsx)("div",{className:"my-6 space-y-0",children:s.map((e,t)=>(0,n.jsxs)(i.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.1*t},className:"relative pl-8 pb-8 last:pb-0",children:[t<s.length-1&&(0,n.jsx)("div",{className:"absolute left-[11px] top-6 bottom-0 w-px bg-white/10"}),(0,n.jsx)("div",{className:"absolute left-0 top-0 w-6 h-6 rounded-full bg-lime/20 border border-lime/40 flex items-center justify-center",children:(0,n.jsx)("span",{className:"text-xs font-bold text-lime",children:t+1})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h4",{className:"text-base font-semibold text-white mb-1",children:e.title}),e.description&&(0,n.jsx)("p",{className:"text-sm text-white/50 mb-3",children:e.description}),e.code&&(0,n.jsx)("pre",{className:"bg-white/[0.03] border border-white/[0.06] rounded-lg p-3 overflow-x-auto my-2",children:(0,n.jsx)("code",{className:"text-sm text-lime/90 font-mono",children:e.code})}),e.content&&(0,n.jsx)("div",{className:"text-sm text-white/70",children:e.content})]})]},t))})}function c(e){let{features:s}=e;return(0,n.jsx)("ul",{className:"my-4 space-y-2",children:s.map((e,s)=>(0,n.jsxs)(i.E.li,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:.05*s},className:"flex items-start gap-2",children:[(0,n.jsx)(a.Z,{className:"w-4 h-4 text-lime mt-0.5 flex-shrink-0"}),(0,n.jsx)("span",{className:"text-sm text-white/70",children:e})]},s))})}function l(e){let{title:s,description:t,icon:a,href:o,children:c}=e,l=o?"a":"div";return(0,n.jsx)(i.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},whileHover:o?{y:-2}:void 0,children:(0,n.jsxs)(l,{...o?{href:o,className:"block"}:{},className:(0,r.cn)("p-4 rounded-lg border border-white/[0.06] bg-white/[0.02]",o&&"hover:border-lime/30 hover:bg-white/[0.04] transition-all cursor-pointer"),children:[a&&(0,n.jsx)("div",{className:"w-8 h-8 rounded-lg bg-lime/10 flex items-center justify-center mb-3",children:(0,n.jsx)(a,{className:"w-4 h-4 text-lime"})}),(0,n.jsx)("h4",{className:"text-base font-semibold text-white mb-1",children:s}),t&&(0,n.jsx)("p",{className:"text-sm text-white/50",children:t}),c]})})}function m(e){let{children:s,columns:t=2}=e;return(0,n.jsx)("div",{className:(0,r.cn)("grid gap-4 my-6",2===t&&"md:grid-cols-2",3===t&&"md:grid-cols-3"),children:s})}}},function(e){e.O(0,[5293,2150,2716,2971,8069,1744],function(){return e(e.s=5120)}),_N_E=e.O()}]);